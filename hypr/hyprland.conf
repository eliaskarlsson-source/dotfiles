########################################
# Hyprland – Catppuccin Polished
###################################################

# --- Monitor ---
monitor = DP-2, 1920x1080@60, 0x0, 1

# --- General ---
general {
  gaps_in = 6
  gaps_out = 12
  border_size = 2
  col.active_border = rgba(cba6f7ff) rgba(89b4faff) 45deg
  col.inactive_border = rgba(45475aff)
  layout = dwindle
  resize_on_border = true
  extend_border_grab_area = 15
  hover_icon_on_border = true
  allow_tearing = false
  no_focus_fallback = false
}

# --- Decoration ---
decoration {
  rounding = 12
  active_opacity = 1.0
  inactive_opacity = 0.95
  fullscreen_opacity = 1.0
  shadow {
    enabled = true
    range = 20
    render_power = 3
    ignore_window = true
    color = rgba(00000055)
    color_inactive = rgba(00000025)
  }
  blur {
    enabled = true
    size = 8
    passes = 2
    new_optimizations = true
    xray = false
    noise = 0.0117
    contrast = 0.8916
    brightness = 0.8172
    vibrancy = 0.1696
    vibrancy_darkness = 0.0
    popups = false
    ignore_opacity = true
  }
}

# --- Animations ---
animations {
  enabled = true
  
  # Optimized Bezier curves for smoother animations
  bezier = overshot, 0.05, 0.9, 0.1, 1.05
  bezier = smoothOut, 0.25, 0.46, 0.45, 0.94
  bezier = smoothIn, 0.16, 1, 0.3, 1
  bezier = wind, 0.05, 0.9, 0.1, 1.05
  bezier = winIn, 0.1, 1.1, 0.1, 1.1
  bezier = winOut, 0.3, -0.3, 0, 1
  bezier = liner, 1, 1, 1, 1
  bezier = easeOutQuint, 0.23, 1, 0.32, 1
  
  # Enhanced animations
  animation = windows, 1, 5, easeOutQuint, slide
  animation = windowsIn, 1, 5, winIn, slide
  animation = windowsOut, 1, 4, winOut, slide
  animation = windowsMove, 1, 4, wind, slide
  animation = border, 1, 1, liner
  animation = borderangle, 1, 30, liner, loop
  animation = fade, 1, 7, smoothOut
  animation = fadeDim, 1, 7, smoothIn
  animation = workspaces, 1, 4, easeOutQuint
  animation = specialWorkspace, 1, 5, smoothOut, slidevert
  animation = layers, 1, 3, easeOutQuint, fade
}

# --- Input ---
input {
  kb_layout = us, se
  kb_options = grp:alt_shift_toggle
  follow_mouse = 1
  mouse_refocus = true
  float_switch_override_focus = 2
  sensitivity = 0.0
  accel_profile = adaptive
  force_no_accel = false
  repeat_rate = 50
  repeat_delay = 300
}

# --- Keybinds ---
$mainMod = SUPER

## Wofi (simplified)
bind = $mainMod, R, exec, ~/scripts/wofi-launcher.sh apps
bind = $mainMod SHIFT, R, exec, ~/scripts/wofi-launcher.sh run
bind = $mainMod, Tab, exec, ~/scripts/wofi-launcher.sh window

## Wallpaper management (unified wallpaper.sh)
bind = $mainMod, W, exec, ~/scripts/wallpaper.sh --random
bind = $mainMod SHIFT, Right, exec, ~/scripts/wallpaper.sh --next
bind = $mainMod SHIFT, Left, exec, ~/scripts/wallpaper.sh --prev

## System utilities
bind = $mainMod, I, exec, kitty --class hypr-health -e ~/scripts/hypr-utils.sh health

# Applications
bind = $mainMod, Return, exec, kitty
bind = $mainMod, E, exec, thunar
bind = $mainMod, Q, killactive
bind = $mainMod, F, fullscreen, 0
bind = $mainMod SHIFT, F, fullscreen, 1
bind = $mainMod, V, togglefloating
bind = $mainMod, M, exit
bind = $mainMod, B, exec, firefox
bind = $mainMod, C, exec, code
bind = $mainMod, D, exec, discord
bind = $mainMod, S, exec, spotify
bind = $mainMod, N, exec, obsidian
bind = $mainMod SHIFT, S, exec, steam
bind = $mainMod, A, exec, pavucontrol
bind = $mainMod SHIFT, E, exec, code ~/dotfiles

# Move focus
bind = $mainMod, LEFT, movefocus, l
bind = $mainMod, RIGHT, movefocus, r
bind = $mainMod, UP, movefocus, u
bind = $mainMod, DOWN, movefocus, d

# Move windows
bind = $mainMod SHIFT, LEFT, movewindow, l
bind = $mainMod SHIFT, RIGHT, movewindow, r
bind = $mainMod SHIFT, UP, movewindow, u
bind = $mainMod SHIFT, DOWN, movewindow, d

# Resize windows
bind = $mainMod CTRL, LEFT, resizeactive, -20 0
bind = $mainMod CTRL, RIGHT, resizeactive, 20 0
bind = $mainMod CTRL, UP, resizeactive, 0 -20
bind = $mainMod CTRL, DOWN, resizeactive, 0 20


# Workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10



# Audio & Media
bind = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bind = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bind = , XF86AudioMute,        exec, wpctl set-mute   @DEFAULT_AUDIO_SINK@ toggle
bind = , XF86AudioMicMute,     exec, wpctl set-mute   @DEFAULT_AUDIO_SOURCE@ toggle
bind = , XF86AudioPlay,        exec, playerctl play-pause
bind = , XF86AudioPause,       exec, playerctl play-pause
bind = , XF86AudioNext,        exec, playerctl next
bind = , XF86AudioPrev,        exec, playerctl previous

# Window management
bind = $mainMod, J, togglesplit, # dwindle
bind = $mainMod, P, pseudo, # dwindle
bind = $mainMod SHIFT, V, pin
bind = $mainMod, Tab, cyclenext,
bind = $mainMod SHIFT, Tab, cyclenext, prev



# Lock screen
bind = $mainMod, L, exec, swaylock

# Emergency exit
bind = $mainMod ALT, M, exit

# Mouse bindings
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Custom script bindings
bind = $mainMod, SPACE, exec, ~/scripts/hypr-utils.sh power
bind = $mainMod SHIFT, SPACE, exec, ~/scripts/hypr-utils.sh screenshot
bind = $mainMod, G, exec, ~/scripts/hypr-utils.sh gamemode
bind = $mainMod, T, exec, ~/scripts/enhanced-theme-switcher.sh menu
bind = $mainMod SHIFT, T, exec, ~/scripts/enhanced-theme-switcher.sh catppuccin-mocha
bind = $mainMod CTRL, W, exec, ~/scripts/wallpaper.sh --random
bind = $mainMod, Backspace, exec, ~/scripts/hypr-utils.sh reload

# Advanced window management
bind = $mainMod, X, pin
bind = $mainMod SHIFT, X, movetoworkspacesilent, special
bind = $mainMod, Minus, togglespecialworkspace
bind = $mainMod SHIFT, Minus, movetoworkspace, special
bind = $mainMod CTRL, F, workspaceopt, allfloat

# Focus management
bind = ALT, Tab, cyclenext
bind = ALT SHIFT, Tab, cyclenext, prev
bind = $mainMod, bracketleft, focusmonitor, l
bind = $mainMod, bracketright, focusmonitor, r
bind = $mainMod SHIFT, bracketleft, movecurrentworkspacetomonitor, l
bind = $mainMod SHIFT, bracketright, movecurrentworkspacetomonitor, r

# Group management
bind = $mainMod, K, togglegroup
bind = $mainMod SHIFT, K, lockactivegroup, toggle
bind = $mainMod, H, changegroupactive, b
bind = $mainMod, L, changegroupactive, f
bind = $mainMod CTRL, H, moveintogroup, l
bind = $mainMod CTRL, L, moveintogroup, r
bind = $mainMod CTRL, K, moveintogroup, u
bind = $mainMod CTRL, J, moveintogroup, d
bind = $mainMod ALT, H, moveoutofgroup
bind = $mainMod ALT, L, moveoutofgroup

# --- Autostart ---
# --- Performance Optimizations ---
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# Core services (staggered startup for better performance)
exec-once = swww-daemon
exec-once = sleep 1 && waybar
exec-once = sleep 2 && mako
exec-once = sleep 3 && ~/scripts/wallpaper.sh
exec-once = sleep 4 && hyprctl setcursor Bibata-Modern-Ice 24

# System tray applications (delayed startup)
exec-once = sleep 5 && nm-applet --indicator
exec-once = sleep 6 && blueman-applet

# Optional services (start last)
exec-once = sleep 8 && gammastep -l 55.7:12.6 -t 6500:3500 -g 0.8 -m wayland -v &

# Performance monitoring (if needed)
# exec-once = sleep 10 && ~/scripts/hypr-utils.sh health > /tmp/hypr-startup.log


# --- Dwindle Layout ---
dwindle {
  pseudotile = true
  preserve_split = true
  smart_split = true
  smart_resizing = true
}

# --- Window Rules ---

# Opacity rules
windowrulev2 = opacity 0.9 0.9, class:^(kitty)$
windowrulev2 = opacity 0.95 0.95, class:^(thunar)$
windowrulev2 = opacity 0.9 0.9, class:^(pavucontrol)$
windowrulev2 = opacity 0.95 0.95, class:^(firefox)$
windowrulev2 = opacity 0.98 0.98, class:^(code)$
windowrulev2 = opacity 0.9 0.9, class:^(discord)$
windowrulev2 = opacity 0.95 0.95, class:^(spotify)$

# Floating windows
windowrulev2 = float, class:^(pavucontrol)$
windowrulev2 = float, class:^(nm-connection-editor)$
windowrulev2 = float, class:^(blueman-manager)$
windowrulev2 = float, class:^(file-roller)$
windowrulev2 = float, class:^(gnome-calculator)$
windowrulev2 = float, title:^(Picture-in-Picture)$
windowrulev2 = float, title:^(Firefox — Sharing Indicator)$
windowrulev2 = float, class:^(org.gnome.Nautilus)$, title:^(Properties)$
windowrulev2 = float, class:^(hypr-health)$

# Size and position rules
windowrulev2 = size 800 600, class:^(pavucontrol)$
windowrulev2 = center, class:^(pavucontrol)$
windowrulev2 = size 400 300, class:^(gnome-calculator)$
windowrulev2 = center, class:^(gnome-calculator)$
windowrulev2 = size 25% 25%, title:^(Picture-in-Picture)$
windowrulev2 = move 72% 7%, title:^(Picture-in-Picture)$
windowrulev2 = size 1000 700, class:^(hypr-health)$
windowrulev2 = center, class:^(hypr-health)$

# Workspace assignments
windowrulev2 = workspace 2, class:^(firefox)$
windowrulev2 = workspace 3, class:^(code)$
windowrulev2 = workspace 4, class:^(discord)$
windowrulev2 = workspace 5, class:^(spotify)$
windowrulev2 = workspace 6, class:^(steam)$
windowrulev2 = workspace 7, class:^(obs)$

# Special behaviors
windowrulev2 = pin, title:^(Picture-in-Picture)$
windowrulev2 = pin, title:^(Firefox — Sharing Indicator)$
windowrulev2 = suppressevent maximize, class:.*
windowrulev2 = idleinhibit focus, class:^(firefox)$, title:^(.*YouTube.*)$
windowrulev2 = idleinhibit focus, class:^(spotify)$
windowrulev2 = idleinhibit fullscreen, class:^(firefox)$

# Gaming optimizations
windowrulev2 = immediate, class:^(steam_app_.*)$
windowrulev2 = fullscreen, class:^(steam_app_.*)$

# Development tools
windowrulev2 = opacity 0.98 0.98, class:^(jetbrains-.*)$
windowrulev2 = noblur, class:^(jetbrains-.*)$, title:^(win.*)$

# --- Gestures ---
gestures {
  workspace_swipe = true
  workspace_swipe_fingers = 3
  workspace_swipe_distance = 300
  workspace_swipe_invert = true
  workspace_swipe_min_speed_to_force = 30
  workspace_swipe_cancel_ratio = 0.5
  workspace_swipe_create_new = false
  workspace_swipe_forever = false
  workspace_swipe_use_r = false
}

# --- Group Configuration ---
group {
  col.border_active = rgba(cba6f7ff) rgba(89b4faff) 45deg
  col.border_inactive = rgba(45475aff)
  col.border_locked_active = rgba(f38ba8ff)
  col.border_locked_inactive = rgba(585b70ff)
  
  groupbar {
    enabled = true
    font_family = JetBrains Mono Nerd Font
    font_size = 12
    gradients = true
    render_titles = true
    scrolling = true
    text_color = rgba(cdd6f4ff)
    col.active = rgba(89b4faff)
    col.inactive = rgba(45475aff)
    col.locked_active = rgba(f38ba8ff)
    col.locked_inactive = rgba(585b70ff)
  }
}

# --- Misc ---
misc {
  disable_hyprland_logo = true
  disable_splash_rendering = true
  force_default_wallpaper = 0
  vfr = true
  vrr = 1
  mouse_move_enables_dpms = true
  key_press_enables_dpms = true
  always_follow_on_dnd = true
  layers_hog_keyboard_focus = true
  animate_manual_resizes = true
  animate_mouse_windowdragging = true
  disable_autoreload = false
  enable_swallow = true
  swallow_regex = ^(kitty|foot|alacritty)$
  swallow_exception_regex = ^(wev)$
  focus_on_activate = false
  mouse_move_focuses_monitor = true
  allow_session_lock_restore = false
  background_color = 0x111111
  close_special_on_empty = true
  new_window_takes_over_fullscreen = 0
  initial_workspace_tracking = 2
  middle_click_paste = false
  render_ahead_of_time = false
  render_ahead_safezone = 1
}
